(function(){var t,r,i=function(t,r){return function(){return t.apply(r,arguments)}};r=function(t){return window[t]=window[t]||{}},r("transport"),t=window.AnimationFrame,t.shim(24),transport.NikeAirZoomExplorer=function(){function t(t){this.target=t,this.pause=i(this.pause,this),this.play=i(this.play,this),this.spinnerTarget=$(".explorer-spinner",this.target),this.imgBase=$("img.explorer-default-image",this.target),this.framesDir=$(this.target).attr("data-frames-dir"),this.calloutsDir=$(this.target).attr("data-callouts-dir"),this.langDir=$(this.target).attr("data-lang"),this.controlsTarget=$(".explorer-controls",this.target),this.sliderTarget=$(".explorer-range-slider",this.controlsTarget),this.calloutsTarget=$(".explorer-overlays",this.target),this.totalFrames=Number($(this.target).attr("data-frame-count"))||24,this.totalCallouts=7,this.targetFrame=1,this.currentFrame=1,this.imgNamePrefix="shoe_splodin_",this.calloutNamePrefix="callouts_",this.imageFrames=[],this.calloutItems=[],this.calloutsJSON=$(this.target).attr("data-callout-points-json")||null,this.calloutsInOut=[{"in":"2",out:"5"},{"in":"5",out:"8"},{"in":"8",out:"11"},{"in":"11",out:"14"},{"in":"14",out:"17"},{"in":"17",out:"20"},{"in":"23",out:"24"}],this.initLoading()}return t.IMAGES_LOAD_COMPLETE="transport.images.complete",t.SVG_LOAD_COMPLETE="transport.svg.complete",t.prototype.initLoading=function(){return this.spinner=new Spinner({color:"#fff",width:2,length:20,radius:50,lines:12}).spin(),this.spinnerTarget.append(this.spinner.el),this.jsonRQ=$.getJSON(this.calloutsJSON,function(t){return function(r){t.calloutsInOut=r,t.totalCallouts=t.calloutsInOut.length}}(this)).fail(function(t){return function(t,r,i){console.log(r+" "+i),console.log("failed to load NikeAirZoomExplorer callout points JSON. Reverting to defaults.")}}(this)).always(function(t){return function(){t.preloadImgs()}}(this))},t.prototype.preloadImgs=function(){var t,r,i,e;for(this.frameSrcs=[],t=r=1,i=this.totalFrames+1;i>r;t=r+=1)e=this.framesDir+this.imgNamePrefix+t+".jpg",this.frameSrcs.push(e);return this.framesPreloader=new ImagePreloader({urls:this.frameSrcs,complete:function(t){return $(window).trigger(transport.NikeAirZoomExplorer.IMAGES_LOAD_COMPLETE)}}),this.framesPreloader.start(),$(window).on(transport.NikeAirZoomExplorer.IMAGES_LOAD_COMPLETE,function(t){return function(r){return t.preloadSvgs()}}(this))},t.prototype.preloadSvgs=function(){var t,r,i,e;for(this.svgSrcs=[],t=r=1,i=this.totalCallouts+1;i>r;t=r+=1)e=this.calloutsDir+this.langDir+this.calloutNamePrefix+t+".svg",this.svgSrcs.push(e);return this.svgPreloader=new ImagePreloader({urls:this.svgSrcs,complete:function(t){return $(window).trigger(transport.NikeAirZoomExplorer.SVG_LOAD_COMPLETE)}}),this.svgPreloader.start(),$(window).on(transport.NikeAirZoomExplorer.SVG_LOAD_COMPLETE,function(t){return function(r){return t.initApp()}}(this))},t.prototype.initApp=function(){return this.spinner.stop(),this.buildCallouts(),this.bindEvents(),this.controlsTarget.fadeIn(800),this.play()},t.prototype.bindEvents=function(){var t;return t=this,this.slider=document.getElementById("explorerSlider"),noUiSlider.create(this.slider,{start:1,connect:"lower",step:1,range:{min:1,max:this.totalFrames}}),this.slider.noUiSlider.on("update",function(r,i){return t.targetFrame=Math.floor(r[i]),t.doCallout(Math.floor(r[i]))})},t.prototype.play=function(){var t;return this.currentFrame!==this.targetFrame&&(this.currentFrame+=(this.targetFrame-this.currentFrame)/5),t=Math.floor(this.currentFrame),this.gotoFrame(t),this.req=window.requestAnimationFrame(this.play)},t.prototype.pause=function(){return window.cancelAnimationFrame(this.req)},t.prototype.gotoFrame=function(t){var r;if(!(0>=t))return r=this.framesDir+this.imgNamePrefix+t+".jpg",this.imgBase.attr("src",r)},t.prototype.doCallout=function(t){var r,i,e,s,o,n,a,l;for(r=0,a=this.calloutsInOut,l=[],i=0,e=a.length;e>i;i++)n=a[i],s=Number(n["in"]),o=Number(n.out),t>=s&&o>=t?this.calloutItems[r].fadeIn():this.calloutItems[r].fadeOut(200),l.push(r++);return l},t.prototype.buildCallouts=function(){var t,r,i,e,s,o;for(e=this.svgSrcs,s=[],t=0,r=e.length;r>t;t++)o=e[t],i=$("<li style='background-image: url("+o+")'></li>"),this.calloutItems.push(i),s.push(this.calloutsTarget.append(i));return s},t}()}).call(this);