(function(){var t,r,e=function(t,r){return function(){return t.apply(r,arguments)}};r=function(t){return window[t]=window[t]||{}},r("transport"),t=window.AnimationFrame,t.shim(20),transport.ImageScrubber=function(){function t(t){this.target=t,this.pause=e(this.pause,this),this.play=e(this.play,this),this.spinnerTarget=$(".explorer-spinner",this.target),this.framesDir=$(this.target).attr("data-frames-dir"),this.calloutsDir=$(this.target).attr("data-callouts-dir"),this.langDir=$(this.target).attr("data-lang"),this.sliderTarget=$(".explorer-range-slider",this.target),this.framesCanvas=document.getElementById("explorerFramesCanvas"),this.framesContext=this.framesCanvas.getContext("2d"),this.calloutsTarget=$(".explorer-overlays",this.target),this.totalFrames=parseInt($(this.target).attr("data-frame-count"))||24,this.totalCallouts=7,this.targetFrame=1,this.currentFrame=1,this.imgNamePrefix="shoe_splodin_",this.calloutNamePrefix="callouts_",this.imageFrames=[],this.calloutItems=[],this.calloutsInOut=[{"in":"2",out:"5"},{"in":"5",out:"8"},{"in":"7",out:"10"},{"in":"10",out:"13"},{"in":"13",out:"17"},{"in":"17",out:"21"},{"in":"23",out:"21"}],this.init()}return t.IMAGES_LOAD_COMPLETE="transport.images.complete",t.SVG_LOADED="transport.svg.loaded",t.SVG_LOAD_COMPLETE="transport.svg.complete",t.ON_SLIDE="transport.on.slide",t.prototype.init=function(){return this.preloadImgs()},t.prototype.initEvents=function(){var t;return t=this,this.slider=document.getElementById("explorerSlider"),noUiSlider.create(this.slider,{start:1,connect:"lower",step:1,range:{min:1,max:24}}),this.slider.noUiSlider.on("update",function(r,e){return t.targetFrame=Math.floor(r[e]),t.doCallout(Math.floor(r[e]))}),this.play()},t.prototype.play=function(){var t;return this.currentFrame!==this.targetFrame&&(this.currentFrame+=(this.targetFrame-this.currentFrame)/5),t=Math.floor(this.currentFrame),this.gotoFrame(t),this.req=window.requestAnimationFrame(this.play)},t.prototype.pause=function(){return window.cancelAnimationFrame(this.req)},t.prototype.gotoFrame=function(t){var r,e;if(!(0>=t))return e=this.framesDir+this.imgNamePrefix+t+".jpg",r=new Image,r.src=e,this.framesContext.drawImage(r,0,0,this.framesCanvas.width,this.framesCanvas.height)},t.prototype.doCallout=function(t){var r,e,s,i,a,n;for(r=0,a=this.calloutsInOut,n=[],e=0,s=a.length;s>e;e++)i=a[e],t===Number(i["in"])?(console.log("doCallout frame "+t),this.calloutItems[r].fadeIn(),console.log("i is "+r)):t===Number(i.out)&&this.calloutItems[r].fadeOut(),n.push(r++);return n},t.prototype.preloadImgs=function(){var t,r,e,s;for(this.spinner=new Spinner({color:"#fff",width:2,length:20,radius:50,lines:12}).spin(),this.spinnerTarget.append(this.spinner.el),this.frameSrcs=[],t=r=1,e=this.totalFrames+1;e>r;t=r+=1)s=this.framesDir+this.imgNamePrefix+t+".jpg",this.frameSrcs.push(s);return this.framesPreloader=new ImagePreloader({urls:this.frameSrcs,complete:function(t){return $(window).trigger(transport.ImageScrubber.IMAGES_LOAD_COMPLETE)}}),this.framesPreloader.start(),$(window).on(transport.ImageScrubber.IMAGES_LOAD_COMPLETE,function(t){return function(r){return console.log("images loaded"),t.preloadSvgs()}}(this))},t.prototype.preloadSvgs=function(){var t,r,e,s;for(this.svgSrcs=[],t=r=1,e=this.totalCallouts+1;e>r;t=r+=1)s=this.calloutsDir+this.langDir+this.calloutNamePrefix+t+".svg",this.svgSrcs.push(s);return this.svgPreloader=new ImagePreloader({urls:this.svgSrcs,imageLoad:function(t){return $(window).trigger(transport.ImageScrubber.SVG_LOADED,[t])},complete:function(t){return $(window).trigger(transport.ImageScrubber.SVG_LOAD_COMPLETE)}}),this.svgPreloader.start(),$(window).on(transport.ImageScrubber.SVG_LOADED,function(t){return function(r,e){var s;return console.log(e),s=$("<li style='background: url("+e.url+") center no-repeat; background-size: contain;'></li>"),console.log(s),t.calloutItems.push(s),t.calloutsTarget.append(s)}}(this)),$(window).on(transport.ImageScrubber.SVG_LOAD_COMPLETE,function(t){return function(r){return console.log("svgs loaded"),t.spinner.stop(),t.initEvents()}}(this))},t}()}).call(this);